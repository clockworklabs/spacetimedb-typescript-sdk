# Notes for maintainers

The file `client_api.ts` is generated by [ts-proto](https://github.com/stephenh/ts-proto)
from [the SpacetimeDB client-api-messages proto definition](https://github.com/clockworklabs/SpacetimeDB/blob/master/crates/client-api-messages/protobuf/client_api.proto).
This is not automated.
Whenever the `client_api.proto` changes, you'll have to manually re-run `protoc` to re-generate the definitions.

```sh
cd spacetimedb-typescript-sdk
npm i # get the dev-dependencies
cd ~/path/to/SpacetimeDB/crates/client-api-messages/protobuf
protoc --plugin=/absolute/path/to/spacetimedb-typescript-sdk/node_modules/.bin/protoc-gen-ts_proto \
  --ts_proto_out=/absolute/path/to/spacetimedb-typescript-sdk/src \
  ./client_api.proto
```

Note that `protoc` cannot understand paths that start with `~`;
you must write the absolute path starting from `/`.

For reasons that escape me, `protoc-gen-ts` emits an incorrect import for `Long`.
After generating, you may have to manually edit `client_api.ts` by replacing:

```ts
import Long = require("long");
```

with:

```ts
import Long from "long";
```
